# Особенности проекта PizzaWay

## Сложности, особенности и рекомендации по улучшению

Для большего понимания проекта, рекомендуется ознакомиться с документом `CLEAN_ARCHITECTURE.md`, чтобы понимать
структуру проекта и принципы работы с ним.

### Код-генерация

В проекте используется множество библиотек для код-генерации. Среди таких задач можно выделить:

- Генерация кода для работы с RestAPI
- Генерация кода для работы с JSON
- Генерация кода для бизнес-логики

### Работа с RestAPI и JSON

Для того чтобы найти информация о запросах необходимо перейти в папку `lib/core/api`. В ней находятся все запросы к
серверу, в том числе чаты, общие и обращение к прокси для работы с 1C. Все запросы

На данный момент в приложении используется RestAPI для работы с сервером. Оно построено на код-генерации использования
библиотеки `retrofit` и `json_serializable`. Для работы с JSON используется библиотека `json_annotation`. Для подмены
доменов необходимо перейти в файл `lib/core/api/pizza_day_api.dart` и изменить значение переменной `baseUrl`. Есть два
варианта доменов, соответсвующий `dev` и `prod`:

- pizzawaydev.pp.ua;
- lms.pizzaday.ua.

После смены доменов, чтобы изменения вошли в силу, необходимо сгенерировать файлы с запросами. Для этого необходимо
выполнить команду `dart run build_runner build --delete-conflicting-outputs`.

Рекомендации по улучшению:

- Было бы хорошо уйти от подкидывания доменов вручную и использовать переменные окружения для этого. Но на данный момент
  это не реализовано, так как это требует дополнительной работы и решения таких проблем, как генерация кода.
- Уйти от использования `retrofit` и обращаться к абстракции, а не к конкретному клиенту. Это позволит в дальнейшем
  легко заменить библиотеку на другую, если это потребуется.
- Необходимо перенести все запросы разбить на составляющие и разместить их в соответствующих папках. Например, все
  запросы к чатам перенести в фичу `chat`, курсы в `courses` и т.д.

### Модели и сущности

Главное отличие модели от сущности заключается в том, что сущность - это фактически набор полей, а модель(корректнее
`DTO` - `Data Transfer Object`). Для улучшения кода будет необходимо:

- Сделать так, чтобы модели наследовались от сущности, которая в свое время наследуется от `Equatable`.
- Вся логика преобразований `json` теперь располагается только в моделях.
- Из слоя даты нужно перестать возвращать модели, а перейти на использование сущностей.

### Инъекция зависимостей

Сейчас для инъекции зависимости используется гибридный способ внедрения зависимостей. У нас существует реализация под
`Service Locator`, которая существует по пути `lib/injector.dart`, где все зависимости внедряются через `get_it`, и при
этом часть из них внедряется через конструктор.

Вследствие этого, зависимости связанные которые находятся выше UseCase, внедряются через конструктор, дают нам четкое
понимание, от чего зависит этот компонент, а уже бизнес логика имеет эти зависимости внутри и обращается к ним через
`injector<T>`, что усложняет понимание зависимостей компонентов.

Рекомендация по улучшению:

- Уйти в целом от инъекции зависимости с использованием `get_it` и `Service Locator`, в пользу
  `Dependency Injection Container`, что даст возможность четко понимать зависимости для бизнес-компонентов, ограничить
  зону видимости зависимостей и удалить лишний пакет из приложения.

### Роутинг

В проекте используется библиотека `go_router` для роутинга. Но она используется не корректно. Все роуты, которые
находятся в приложении, фактически находятся на одном уровне.

Рекомендации по улучшению:

- Разделить роуты на отдельные файлы, а в идеале начать выстраивать иерархию экранов, чтобы было легче ориентироваться в
  них и дать возможность правильно работать `context.go`;
- Удалить корневой `ShellRoute` для `TalkerWidget`, и перейти к использованию `LoggerScaffold`;
- Передавать данные через сам путь и не использовать `arguments` для этого;
- Существуют поля, которые не используются, их необходимо удалить.

### Deeplinks

Нынешний роутинг дает нам возможность работать с диплинками, но есть проблемы, которые стоит решить:

- Сейчас при открытии какой-то диплинки(или пуш уведомления) мы не имеем достаточно информации для открытия нужного
  экрана. И по этому по набору данных мы делаем предварительный запрос на сервер, чтобы получить необходимые данные, а
  затем открываем экран и делаем снова запрос. Необходимо переписать так, чтобы избавиться от первого запроса, а делать
  только один.

### Тема

В проекте используется тема, которая находится в файле `lib/core/themes/theme.dart`. Проблемы и решения:

- В случае, если будет необходимость расширить цветовое пространство или же будет необходимость добавить новых шрифтом,
  нужно будет расширять тему при помощи `extensions`, куда можно будет внедрять новые цвета палитры, новые шрифты.
- Переписать название цветовой палитры на более абстрактные, чтобы не ссылаться на конкретные цвета. К примеру `text`
  вместо `black` для светлой темы и `white` для темной.

### Виджеты

С виджетами в проекте все очень хорошо, но есть рекомендация о создании единого входа для разных типов одного и того же
виджета. Сейчас существует несколько файлов, которые относятся к шрифтам. Чтобы этого избежать - нужно использовать
единый класс с разными конструкторами. Аналогично для кнопок.

### Кастомные ошибки с сервера

Для улучшения связи с сервером рекомендую создать единый класс, который будет отвечать за ошибки, которые присылаются от
бека и которые можно парсить, чтобы можно было их получить, отобразить для пользователя без особых проблем, что облегчит
работу самому разработчику и так и может улучить взаимодействие пользователя с приложением. 
